import time
import json
import boto3


def lambda_handler(event, context):
    # EC2 instance ID
    instance_id = 'i-065b732c78a5b70f1'

    # Boto3 clients
    client = boto3.client("ec2")
    ssm = boto3.client("ssm")

    try:
        # Command to be executed on the instance
        response = ssm.send_command(
            InstanceIds=[instance_id],
            DocumentName="AWS-RunShellScript",
            Parameters={
                "commands": ["bash /home/ubuntu/volatility3/bashcode.sh"]
            },
        )

        # Fetch the command ID for the output
        command_id = response["Command"]["CommandId"]

        time.sleep(30)

        # Fetch the command output
        output = ssm.get_command_invocation(CommandId=command_id, InstanceId=instance_id)
        print(output)

        return {"statusCode": 200, "body": json.dumps("DONE")}

    except Exception as e:
        # Handle any exceptions that occurred during command execution
        return {"statusCode": 500, "body": json.dumps({"Error": str(e)})}